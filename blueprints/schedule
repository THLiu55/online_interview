from flask import Blueprint, request, jsonify
from models import CreateInterviewModel
from exts import db
from forms import ScheduleForm

schedule_bp = Blueprint("schedule", __name__, url_prefix="/schedule")

@schedule_bp.route("/schedule", methods=['POST', 'GET'])
def register_check():
    data = request.get_json(silent=True)
    position = data["position"]
    date = data["date"]
    time = data["time"]
    time_span = data["time_span"]
    interviewee_name = data["interviewee_name"]
    schedule_form = ScheduleForm(position=position, date=date, time=time, time_span=time_span,
                                 interviewee_name=interviewee_name)
    if schedule_form.validate():
        # 构建CreateInterviewModel模型
        createInterviewModel = CreateInterviewModel()
        CreateInterviewModel.position = position
        CreateInterviewModel.date = date
        CreateInterviewModel.time = time
        CreateInterviewModel.time_span = time_span
        CreateInterviewModel.interviewee_name = interviewee_name
        db.session.add(CreateInterviewModel)
        db.session.commit()
        return jsonify({"code": 200, "message": "Sign up successfully!"})
    else:
        if schedule_form.errors.get("position"):
            return jsonify({"code":400,"message": "invalidPosition"})
        elif schedule_form.errors.get("date"):
            return jsonify({"code":400, "message": "invalidDate"})
        elif schedule_form.errors.get("time"):
            return jsonify({"code":400,"message":"invalidTime"})
        elif schedule_form.errors.get("time_span"):
            return jsonify({"code":400,"message":"invalidTime_span"})
        else:
            return jsonify({"code":400,"message":"invalidInterviewee_name"})
